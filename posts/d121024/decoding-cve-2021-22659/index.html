



<!DOCTYPE html>
<html lang="en" itemscope itemtype="http://schema.org/WebPage">
  <head>
    

  <meta charset="utf-8" />
  <meta http-equiv="X-UA-Compatible" content="IE=edge">
  <meta name="viewport" content="width=device-width, initial-scale=1.0, maximum-scale=1.0">

 


      <title>Decoding CVE-2021-22659: How to Protect the MicroLogix 1400 from Attacks - Daminha Blog</title>

  <meta name="description" content="This blog delves into the vulnerabilities associated with the MicroLogix 1400 PLC, particularly focusing on CVE-2021-22659. Through a detailed analysis, I outline the phases of potential attacks, the underlying Modbus protocol, and the steps necessary for effective remediation. By understanding the intricacies of this vulnerability and employing robust security measures, organizations can better protect their operational technology environments. With the insights gained from the OPSWAT Fellowship Program, this work serves as a crucial resource for enhancing cybersecurity in industrial settings."><script type="application/ld+json">
{
    "@context": "http://schema.org",
    "@type": "WebSite",
    "name": "Daminha Blog",
    
    "url": "https:\/\/dangduongminhnhat.github.io\/"
}
</script><script type="application/ld+json">
{
  "@context": "http://schema.org",
  "@type": "Organization",
  "name": "",
  "url": "https:\/\/dangduongminhnhat.github.io\/"
  
  
  
  
}
</script>
<script type="application/ld+json">
{
  "@context": "http://schema.org",
  "@type": "BreadcrumbList",
  "itemListElement": [{
        "@type": "ListItem",
        "position": 1,
        "item": {
          "@id": "https:\/\/dangduongminhnhat.github.io\/",
          "name": "home"
        }
    },{
        "@type": "ListItem",
        "position": 3,
        "item": {
          "@id": "https:\/\/dangduongminhnhat.github.io\/posts\/d121024\/decoding-cve-2021-22659\/",
          "name": "Decoding cve 2021 22659 how to protect the micro logix 1400 from attacks"
        }
    }]
}
</script><script type="application/ld+json">
{
  "@context": "http://schema.org",
  "@type": "Article",
  "author": {
    "name" : "Dang Duong Minh Nhat"
  },
  "headline": "Decoding CVE-2021-22659: How to Protect the MicroLogix 1400 from Attacks",
  "description" : "This blog delves into the vulnerabilities associated with the MicroLogix 1400 PLC, particularly focusing on CVE-2021-22659. Through a detailed analysis, I outline the phases of potential attacks, the underlying Modbus protocol, and the steps necessary for effective remediation. By understanding the intricacies of this vulnerability and employing robust security measures, organizations can better protect their operational technology environments. With the insights gained from the OPSWAT Fellowship Program, this work serves as a crucial resource for enhancing cybersecurity in industrial settings.",
  "inLanguage" : "en",
  "wordCount":  3050 ,
  "datePublished" : "2024-10-12T12:18:15\u002b07:00",
  "dateModified" : "2024-10-12T12:18:15\u002b07:00",
  "image" : "https:\/\/dangduongminhnhat.github.io\/",
  "keywords" : [ "CVE-2021-22659, MicroLogix 1400, Industrial Control Systems, CyberSecurity, OPSWAT Fellowship, Vulnerability Research, Modbus Protocol, Remediation Strategies, Operational Technology" ],
  "mainEntityOfPage" : "https:\/\/dangduongminhnhat.github.io\/posts\/d121024\/decoding-cve-2021-22659\/",
  "publisher" : {
    "@type": "Organization",
    "name" : "https:\/\/dangduongminhnhat.github.io\/",
    "logo" : {
        "@type" : "ImageObject",
        "url" : "https:\/\/dangduongminhnhat.github.io\/",
        "height" :  60 ,
        "width" :  60
    }
  }
}
</script>


<meta property="og:title" content="Decoding CVE-2021-22659: How to Protect the MicroLogix 1400 from Attacks" />
<meta property="og:description" content="This blog delves into the vulnerabilities associated with the MicroLogix 1400 PLC, particularly focusing on CVE-2021-22659. Through a detailed analysis, I outline the phases of potential attacks, the underlying Modbus protocol, and the steps necessary for effective remediation. By understanding the intricacies of this vulnerability and employing robust security measures, organizations can better protect their operational technology environments. With the insights gained from the OPSWAT Fellowship Program, this work serves as a crucial resource for enhancing cybersecurity in industrial settings.">
<meta property="og:url" content="https://dangduongminhnhat.github.io/posts/d121024/decoding-cve-2021-22659/" />
<meta property="og:type" content="website" />
<meta property="og:site_name" content="Daminha Blog" />

  <meta name="twitter:title" content="Decoding CVE-2021-22659: How to Protect the MicroLogix 1400 from …" />
  <meta name="twitter:description" content="This blog delves into the vulnerabilities associated with the MicroLogix 1400 PLC, particularly focusing on CVE-2021-22659. Through a detailed analysis, I outline the phases of potential attacks, the …">
  <meta name="twitter:card" content="summary_large_image" />
  <meta name="generator" content="Hugo 0.129.0">
  <link rel="alternate" href="https://dangduongminhnhat.github.io/index.xml" type="application/rss+xml" title="Daminha Blog"><link rel="stylesheet" href="https://cdn.jsdelivr.net/npm/katex@0.16.7/dist/katex.min.css" integrity="sha384-3UiQGuEI4TTMaFmGIZumfRPtfKQ3trwQE2JgosJxCnGmQpL/lJdjpcHkaaFwHlcI" crossorigin="anonymous">
  <link rel="stylesheet" href="https://use.fontawesome.com/releases/v5.5.0/css/all.css" integrity="sha384-B4dIYHKNBt8Bc12p+WXckhzcICo0wtJAoU8YZTY5qE0Id1GSseTk6S+L3BlXeVIU" crossorigin="anonymous">
  <link rel="stylesheet" href="https://cdn.jsdelivr.net/npm/bootstrap@3.4.1/dist/css/bootstrap.min.css" integrity="sha384-HSMxcRTRxnN+Bdg0JdbxYKrThecOKuH5zCYotlSAcp1+c8xmyTe9GYg1l9a69psu" crossorigin="anonymous"><link rel="stylesheet" href="https://dangduongminhnhat.github.io/css/main.css" /><link rel="stylesheet" href="https://fonts.googleapis.com/css?family=Lora:400,700,400italic,700italic" />
  <link rel="stylesheet" href="https://fonts.googleapis.com/css?family=Open+Sans:300italic,400italic,600italic,700italic,800italic,400,300,600,700,800" /><link rel="stylesheet" href="https://dangduongminhnhat.github.io/css/syntax.css" /><link rel="stylesheet" href="https://dangduongminhnhat.github.io/css/codeblock.css" /><link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/photoswipe/4.1.2/photoswipe.min.css" integrity="sha384-h/L2W9KefUClHWaty3SLE5F/qvc4djlyR4qY3NUV5HGQBBW7stbcfff1+I/vmsHh" crossorigin="anonymous">
  <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/photoswipe/4.1.2/default-skin/default-skin.min.css" integrity="sha384-iD0dNku6PYSIQLyfTOpB06F2KCZJAKLOThS5HRe8b3ibhdEQ6eKsFf/EeFxdOt5R" crossorigin="anonymous">

  

<link rel="apple-touch-icon" sizes="180x180" href="/favicon_io/apple-touch-icon.png">
<link rel="icon" type="image/png" sizes="32x32" href="/favicon_io/favicon-32x32.png">
<link rel="icon" type="image/png" sizes="16x16" href="/favicon_io/favicon-16x16.png">
<link rel="manifest" href="/favicon_io/site.webmanifest">

<script type="text/x-mathjax-config">
  MathJax.Hub.Config({
    tex2jax: {
      inlineMath: [['$', '$'], ['\\(', '\\)']],
      processEscapes: true
    }
  });
</script>
<script type="text/javascript" async
  src="https://cdn.mathjax.org/mathjax/latest/MathJax.js?config=TeX-AMS_HTML-full">
</script>
<script type="text/javascript" async
  src="https://cdn.jsdelivr.net/npm/mathjax@3/es5/tex-mml-chtml.js">
</script>


    <meta name="google-site-verification" content="ors8seNeA2TL4hvELynbBtrr4PwXapoPh2td6zTadCU" />
    <meta name="google-site-verification" content="oQJmyNtEP9HjjEcXwRno2_YPeuLd5kX3jTltynIx65s" />
  </head>
  <body>
    <nav class="navbar navbar-default navbar-fixed-top navbar-custom">
  <div class="container-fluid">
    <div class="navbar-header">
      <button type="button" class="navbar-toggle" data-toggle="collapse" data-target="#main-navbar">
        <span class="sr-only">Toggle navigation</span>
        <span class="icon-bar"></span>
        <span class="icon-bar"></span>
        <span class="icon-bar"></span>
      </button>
      <a class="navbar-brand" href="https://dangduongminhnhat.github.io/">Daminha Blog</a>
    </div>

    <div class="collapse navbar-collapse" id="main-navbar">
      <ul class="nav navbar-nav navbar-right">
        
          
            <li>
              <a title="About" href="/posts/about-me/">About</a>
            </li>
          
        
          
            <li>
              <a title="Tags" href="/tags/">Tags</a>
            </li>
          
        
          
            <li>
              <a title="Cryptography Series" href="/posts/cryptography/">Cryptography Series</a>
            </li>
          
        
          
            <li>
              <a title="Note" href="https://hackmd.io/@daminha">Note</a>
            </li>
          
        
          
            <li>
              <a title="Blog" href="/">Blog</a>
            </li>
          
        

        

        
      </ul>
    </div>

    

  </div>
</nav>




    


<div class="pswp" tabindex="-1" role="dialog" aria-hidden="true">

<div class="pswp__bg"></div>

<div class="pswp__scroll-wrap">
    
    <div class="pswp__container">
      <div class="pswp__item"></div>
      <div class="pswp__item"></div>
      <div class="pswp__item"></div>
    </div>
    
    <div class="pswp__ui pswp__ui--hidden">
    <div class="pswp__top-bar">
      
      <div class="pswp__counter"></div>
      <button class="pswp__button pswp__button--close" title="Close (Esc)"></button>
      <button class="pswp__button pswp__button--share" title="Share"></button>
      <button class="pswp__button pswp__button--fs" title="Toggle fullscreen"></button>
      <button class="pswp__button pswp__button--zoom" title="Zoom in/out"></button>
      
      
      <div class="pswp__preloader">
        <div class="pswp__preloader__icn">
          <div class="pswp__preloader__cut">
            <div class="pswp__preloader__donut"></div>
          </div>
        </div>
      </div>
    </div>
    <div class="pswp__share-modal pswp__share-modal--hidden pswp__single-tap">
      <div class="pswp__share-tooltip"></div>
    </div>
    <button class="pswp__button pswp__button--arrow--left" title="Previous (arrow left)">
    </button>
    <button class="pswp__button pswp__button--arrow--right" title="Next (arrow right)">
    </button>
    <div class="pswp__caption">
      <div class="pswp__caption__center"></div>
    </div>
    </div>
    </div>
</div>


  
  
  






  

  <header class="header-section ">
    
    
    <div class="intro-header no-img">
      <div class="container">
        <div class="row">
          <div class="col-lg-8 col-lg-offset-2 col-md-10 col-md-offset-1">
            <div class="posts-heading">
              
                <h1>Decoding CVE-2021-22659: How to Protect the MicroLogix 1400 from Attacks</h1>
              
              
                <hr class="small">
              
              
              
            </div>
          </div>
        </div>
      </div>
    </div>
  
  </header>


    
<div class="container" role="main">
  <div class="row">
    <div class="col-lg-8 col-lg-offset-2 col-md-10 col-md-offset-1">
      <article role="main" class="blog-post">
        <p>
          <strong>Posted on:</strong> October 12, 2024 |
          <strong>Reading time:</strong> 15 minutes |
          <strong>Word count:</strong> 3050 words |
          <strong>Author:</strong> Dang Duong Minh Nhat
        </p>
        <p>In today&rsquo;s interconnected world, the security of industrial control systems is paramount. During my time in the <a href="https://www.opswat.com/careers/cybersecurity-fellowship-program">OPSWAT Fellowship Program</a>, I had the opportunity to dive deep into the intricacies of a critical vulnerability, CVE-2021-22659, affecting Rockwell Automation&rsquo;s MicroLogix 1400 PLC. This blog reflects <a href="https://github.com/dangduongminhnhat/opswats-critical-infrastructure-cybersecurity-graduate-fellowship-program/tree/main/CVE-2021-22659">my journey</a> of researching, simulating an attack, and developing remediation strategies for this vulnerability. I would like to extend my heartfelt gratitude to my mentors, the dedicated OPSWAT team, and the leadership for their unwavering support and guidance, which made this enriching internship experience not only possible but profoundly impactful.</p>
<h2 id="table-of-contents">Table of Contents</h2>
<ul>
<li><a href="#table-of-contents">Table of Contents</a></li>
<li><a href="#securing-industrial-control-systems:-the-importance-of-protecting-the-micrologix-1400-plc">Securing Industrial Control Systems: The Importance of Protecting the MicroLogix 1400 PLC</a>
<ul>
<li><a href="#understanding-the-micrologix-1400-plc">Understanding the MicroLogix 1400 PLC</a></li>
</ul>
</li>
<li><a href="#understanding-cve-2021-22659:-a-critical-vulnerability-in-the-micrologix-1400">Understanding CVE-2021-22659: A Critical Vulnerability in the MicroLogix 1400</a>
<ul>
<li><a href="#what-is-cve-2021-22659?">What Is CVE-2021-22659?</a></li>
</ul>
</li>
<li><a href="#the-phases-of-attack:-how-vulnerabilities-exploit-the-micrologix-1400-plc">The Phases of Attack: How Vulnerabilities Exploit the MicroLogix 1400 PLC</a>
<ul>
<li><a href="#phase-1:-reconnaissance">Phase 1: Reconnaissance</a></li>
<li><a href="#phase-2:-exploitation">Phase 2: Exploitation</a></li>
<li><a href="#phase-3:-denial-of-service">Phase 3: Denial of Service</a></li>
<li><a href="#phase-4:-impact-and-recovery">Phase 4: Impact and Recovery</a></li>
</ul>
</li>
<li><a href="#unpacking-the-modbus-protocol:-a-cornerstone-of-industrial-communication">Unpacking the Modbus Protocol: A Cornerstone of Industrial Communication</a>
<ul>
<li><a href="#what-is-modbus?">What is Modbus?</a></li>
<li><a href="#types-of-modbus-protocols">Types of Modbus Protocols</a></li>
</ul>
</li>
<li><a href="#decoding-modbus-message-structure:-the-backbone-of-industrial-communication">Decoding Modbus Message Structure: The Backbone of Industrial Communication</a>
<ul>
<li><a href="#the-basics-of-modbus-messaging">The Basics of Modbus Messaging</a></li>
<li><a href="#anatomy-of-a-modbus-message">Anatomy of a Modbus Message</a></li>
<li><a href="#data-types-in-modbus">Data Types in Modbus</a></li>
<li><a href="#function-codes:-the-key-to-action">Function Codes: The Key to Action</a></li>
</ul>
</li>
<li><a href="#unveiling-the-vulnerability:-exploiting-cve-2021-22659">Unveiling the Vulnerability: Exploiting CVE-2021-22659</a>
<ul>
<li><a href="#understanding-the-vulnerability">Understanding the Vulnerability</a></li>
<li><a href="#the-process-of-register-overwriting">The Process of Register Overwriting</a></li>
<li><a href="#triggering-a-crash:-the-simulation">Triggering a Crash: The Simulation</a></li>
<li><a href="#the-result:-system-crash">The Result: System Crash</a></li>
</ul>
</li>
<li><a href="#effective-remediation-strategies-for-cve-2021-22659">Effective Remediation Strategies for CVE-2021-22659</a>
<ul>
<li><a href="#leveraging-metadefender-ot-security">Leveraging MetaDefender OT Security</a></li>
<li><a href="#the-ideal-defense-mechanism">The Ideal Defense Mechanism</a></li>
</ul>
</li>
<li><a href="#references">References</a></li>
<li><a href="#connect-with-me">Connect with Me</a></li>
</ul>
<h1 id="securing-industrial-control-systems-the-importance-of-protecting-the-micrologix-1400-plc">Securing Industrial Control Systems: The Importance of Protecting the MicroLogix 1400 PLC</h1>
<p>In today&rsquo;s digital landscape, securing industrial control systems (ICS) and operational technology (OT) environments from remote attacks is more crucial than ever. Vulnerabilities like CVE-2021-22659 pose serious risks, especially for widely used devices like Rockwell Automation’s MicroLogix 1400 Controller. A recent investigation by students from the <a href="https://www.opswat.com/careers/cybersecurity-fellowship-program">OPSWAT Fellowship Program</a> has shed light on this vulnerability, emphasizing the urgent need for robust security measures in these critical systems.</p>
<h2 id="understanding-the-micrologix-1400-plc">Understanding the MicroLogix 1400 PLC</h2>
<p>To grasp the significance of this vulnerability, it&rsquo;s essential to understand what a Programmable Logic Controller (PLC) is. A PLC is an industrial computer designed to automate processes by controlling machinery and industrial operations. Built to endure harsh environments, these devices are programmed to perform specific tasks based on sensor inputs.</p>
<p>The Rockwell Automation MicroLogix 1400 Controller stands out as a compact and modular PLC, widely adopted in small to medium-sized applications. Its cost-effectiveness and flexibility make it a popular choice for many industries. The MicroLogix 1400 supports various communication protocols and offers both digital and analog input/output options, allowing seamless interfacing with other devices.</p>
<p><img src="/images/d121024/how-metadefender-ot-security-protects-the-micrologix-from-cve-2021-22659-1.jpg" alt="Line">
<em><a href="https://www.opswat.com/blog/protecting-ot-systems-from-remote-attacks-how-metadefender-ot-securitytm-protects-the-micrologixtm-1400-controller-from-cve-2021-22659">Source Image</a></em></p>
<p>Programming the MicroLogix 1400 is typically accomplished using Rockwell Automation&rsquo;s software through ladder logic, a graphical programming language that enables users to create complex control sequences. Its versatility allows it to handle tasks ranging from machine control to process automation, while its modular design offers the ability to expand and customize the system based on specific application needs.</p>
<h1 id="understanding-cve-2021-22659-a-critical-vulnerability-in-the-micrologix-1400">Understanding CVE-2021-22659: A Critical Vulnerability in the MicroLogix 1400</h1>
<p>In January 2021, a significant security vulnerability was identified in Rockwell Automation&rsquo;s MicroLogix 1400 controller, a widely used device in industrial control systems. This vulnerability, designated <a href="https://nvd.nist.gov/vuln/detail/CVE-2021-22659">CVE-2021-22659</a>, was reported by Parul Sindhwad and Dr. Faruk Kazi from the COE-CNDS at Veermata Jijabai Technological Institute (VJTI) in India. Their findings highlighted a critical flaw in version 21.6 and earlier, which poses serious risks for organizations relying on this technology.</p>
<h2 id="what-is-cve-2021-22659">What Is CVE-2021-22659?</h2>
<p>Rockwell Automation MicroLogix 1400 Version 21.6 and below may allow a remote unauthenticated attacker to send a specially crafted Modbus packet allowing the attacker to retrieve or modify random values in the register. If successfully exploited, this may lead to a buffer overflow resulting in a denial-of-service condition. The FAULT LED will flash RED and communications may be lost. Recovery from denial-of-service condition requires the fault to be cleared by the user.</p>
<p>NVD evaluated this security vulnerability as <strong>High</strong> severity.</p>
<p><img src="/images/d121024/how-metadefender-ot-security-protects-the-micrologix-from-cve-2021-22659-2.jpg" alt="Line"></p>
<h1 id="the-phases-of-attack-how-vulnerabilities-exploit-the-micrologix-1400-plc">The Phases of Attack: How Vulnerabilities Exploit the MicroLogix 1400 PLC</h1>
<p>The increasing interconnectivity of industrial control systems has unfortunately opened the door to malicious attacks. In the case of the MicroLogix 1400 PLC, vulnerabilities like CVE-2021-22659 create a pathway for remote, unauthenticated attackers to disrupt operations. Understanding the phases of such attacks is crucial for organizations to defend against them effectively.</p>
<p><img src="/images/d121024/how-metadefender-ot-security-protects-the-micrologix-from-cve-2021-22659-3.jpg" alt="Line">
<em><a href="https://www.opswat.com/blog/protecting-ot-systems-from-remote-attacks-how-metadefender-ot-securitytm-protects-the-micrologixtm-1400-controller-from-cve-2021-22659">Source Image</a></em></p>
<h2 id="phase-1-reconnaissance">Phase 1: Reconnaissance</h2>
<p>The first phase of an attack typically involves reconnaissance. In this stage, an attacker seeks to gather information about the target system, including the specific version of the MicroLogix 1400 PLC in use and its network configurations. Tools like packet sniffers can help attackers identify active devices and their communication protocols. This phase lays the groundwork for the attack, as the attacker looks for weaknesses that can be exploited.</p>
<h2 id="phase-2-exploitation">Phase 2: Exploitation</h2>
<p>Once the attacker has gathered sufficient information, they move on to the exploitation phase. With network access to the vulnerable MicroLogix 1400 PLC, the attacker can send specially crafted Modbus packets. These packets can manipulate register values, enabling the attacker to write arbitrary data into the PLC’s memory. Since the Modbus protocol lacks authentication and encryption, the attacker can execute this step without needing any credentials.</p>
<p>This manipulation can lead to various adverse outcomes, such as altering critical control parameters or overriding safety functions. The impact of such changes can be catastrophic, especially in environments where safety and precision are paramount.</p>
<h2 id="phase-3-denial-of-service">Phase 3: Denial of Service</h2>
<p>The exploitation of the vulnerability can escalate into a denial-of-service (DoS) condition. If the attacker successfully sends a sufficient number of malformed packets, it can overwhelm the PLC’s processing capabilities, leading to a buffer overflow. As a result, the device may crash, and the FAULT LED will flash red, indicating that something has gone critically wrong.</p>
<p>This DoS condition doesn’t just cause the PLC to become unresponsive; it can halt entire manufacturing processes, leading to significant downtime. For businesses, this means interrupted operations, lost revenue, and potential damage to machinery—all of which can have long-lasting repercussions.</p>
<h2 id="phase-4-impact-and-recovery">Phase 4: Impact and Recovery</h2>
<p>The aftermath of such an attack can be profound. Beyond the immediate operational disruptions, organizations may face reputational damage, loss of customer trust, and potential regulatory penalties. Furthermore, recovery from a denial-of-service condition often requires manual intervention to clear faults and reset the PLC, further delaying operations.</p>
<p>Organizations must recognize the importance of swift response strategies in this phase. Implementing incident response plans that include monitoring systems for abnormal behavior and quickly isolating affected devices can mitigate the damage caused by such attacks.</p>
<h1 id="unpacking-the-modbus-protocol-a-cornerstone-of-industrial-communication">Unpacking the Modbus Protocol: A Cornerstone of Industrial Communication</h1>
<p>In the world of industrial automation, effective communication between devices is crucial for ensuring smooth operations. One of the most widely used communication protocols for this purpose is the Modbus protocol, developed by Modicon in 1979. Initially designed for Modicon&rsquo;s PLCs, Modbus has evolved into a standard messaging structure that facilitates client-server communication among various intelligent devices in industrial settings.</p>
<h2 id="what-is-modbus">What is Modbus?</h2>
<p>At its core, Modbus is a protocol that allows different devices, such as sensors, actuators, and controllers, to communicate with one another. It defines a simple and efficient way for devices to exchange data, making it a popular choice in various industrial applications. The protocol’s ease of use and compatibility with a range of devices have contributed to its widespread adoption across the globe.</p>
<h2 id="types-of-modbus-protocols">Types of Modbus Protocols</h2>
<p>Modbus exists in several formats, primarily catering to different communication needs. The two main types are <strong>Modbus RTU</strong> and <strong>Modbus TCP</strong>, each suited for specific environments and requirements.</p>
<p><img src="/images/d121024/how-metadefender-ot-security-protects-the-micrologix-from-cve-2021-22659-4.jpg" alt="Line">
<em><a href="https://www.opswat.com/blog/protecting-ot-systems-from-remote-attacks-how-metadefender-ot-securitytm-protects-the-micrologixtm-1400-controller-from-cve-2021-22659">Source Image</a></em></p>
<ol>
<li><strong>Modbus RTU (Remote Terminal Unit):</strong>
<ul>
<li><strong>Communication Method:</strong> Modbus RTU uses serial communication to transmit data. It directly sends data in binary form, which makes it efficient for devices that communicate over serial lines.</li>
<li><strong>Use Case:</strong> This version is typically used in applications where devices are located relatively close to each other, such as in manufacturing plants or process automation systems. It operates effectively over RS-232 or RS-485 communication lines, supporting multiple devices on a single network.</li>
</ul>
</li>
<li><strong>Modbus TCP (Transmission Control Protocol):</strong>
<ul>
<li><strong>Communication Method:</strong> Modbus TCP encapsulates Modbus protocol data into TCP packets, allowing it to be transmitted over standard Ethernet networks.</li>
<li><strong>Use Case:</strong> This version is ideal for modern industrial environments where devices are often distributed over larger distances and connected via TCP/IP networks. The use of Ethernet enables faster data transmission and greater network flexibility, making it easier to integrate with other IT infrastructure.</li>
</ul>
</li>
</ol>
<h1 id="decoding-modbus-message-structure-the-backbone-of-industrial-communication">Decoding Modbus Message Structure: The Backbone of Industrial Communication</h1>
<p>In the realm of industrial automation, the ability for devices to communicate effectively is paramount. At the heart of this communication lies the <strong>Modbus protocol</strong>, a robust request-response framework that allows devices to exchange vital information. Understanding how Modbus messages are structured can empower engineers and technicians to harness its full potential in their operations.</p>
<h2 id="the-basics-of-modbus-messaging">The Basics of Modbus Messaging</h2>
<p>A Modbus communication session begins with a client device transmitting a request to a secondary Modbus device. This request contains essential information, prompting the secondary device to perform a specific action and respond accordingly. The simplicity of this request-response model is one of the reasons Modbus has become a staple in industrial environments.</p>
<p><img src="/images/d121024/how-metadefender-ot-security-protects-the-micrologix-from-cve-2021-22659-5.jpg" alt="Line">
<em><a href="https://www.opswat.com/blog/protecting-ot-systems-from-remote-attacks-how-metadefender-ot-securitytm-protects-the-micrologixtm-1400-controller-from-cve-2021-22659">Source Image</a></em></p>
<h2 id="anatomy-of-a-modbus-message">Anatomy of a Modbus Message</h2>
<p>Each Modbus message sent from a primary device to a secondary one contains several critical components:</p>
<ol>
<li><strong>Address of the Secondary Device:</strong> This identifies which device the message is intended for, ensuring the correct recipient processes the request.</li>
<li><strong>Command:</strong> The command indicates the action the secondary device should perform, such as “read register” or “write register.” This functionality is crucial for the device to know how to respond.</li>
<li><strong>Data:</strong> This section holds the actual information that the command will operate on, whether it’s a value to be written or a request for data to be read.</li>
<li><strong>Checksum (LRC or CRC):</strong> To ensure data integrity, each message includes a checksum. This allows the receiving device to verify that the message has not been corrupted during transmission.</li>
</ol>
<p><img src="/images/d121024/how-metadefender-ot-security-protects-the-micrologix-from-cve-2021-22659-6.jpg" alt="Line">
<em><a href="https://www.opswat.com/blog/protecting-ot-systems-from-remote-attacks-how-metadefender-ot-securitytm-protects-the-micrologixtm-1400-controller-from-cve-2021-22659">Source Image</a></em></p>
<h2 id="data-types-in-modbus">Data Types in Modbus</h2>
<p>Modbus defines four primary data types, each serving a distinct purpose in the communication process:</p>
<ul>
<li><strong>Coil:</strong> Read-write single-bit outputs, used for controlling devices like relays.</li>
<li><strong>Discrete Input:</strong> Read-only single-bit inputs, typically used for sensors that provide binary status (e.g., on/off).</li>
<li><strong>Input Register:</strong> Read-only 16-bit input registers, which hold numerical values that the PLC can read.</li>
<li><strong>Holding Register:</strong> Read-write 16-bit output registers, where numerical values can be stored and modified.</li>
</ul>
<p>Each data type plays a vital role in the overall functionality of a Modbus network, allowing for a diverse range of applications.</p>
<h2 id="function-codes-the-key-to-action">Function Codes: The Key to Action</h2>
<p>Modbus also employs function codes to specify the type of action being requested. These function codes fall into three categories:</p>
<ol>
<li><strong>Public Function Codes:</strong> These range from 1 to 127 and are available for general use.</li>
<li><strong>User-Defined Function Codes:</strong> These are in two specific ranges (65-72 and 100-110) and allow users to implement custom functionalities.</li>
<li><strong>Reserved Function Codes:</strong> These are used by specific companies for legacy products and are not available for public use.</li>
</ol>
<p>Some common function codes include:</p>
<ul>
<li><strong>Read Discrete Inputs (Function Code 2):</strong> Requests the status of discrete inputs.</li>
<li><strong>Read Coils (Function Code 1):</strong> Allows the client to read the status of coils.</li>
<li><strong>Write Single Coil (Function Code 5):</strong> Enables the client to write a value to a single coil.</li>
<li><strong>Read Input Registers (Function Code 4):</strong> Requests data from input registers.</li>
<li><strong>Write Multiple Holding Registers (Function Code 16):</strong> Allows for writing values to multiple holding registers at once.</li>
</ul>
<p>These function codes provide a structured way to request specific actions, making Modbus both versatile and efficient.</p>
<h1 id="unveiling-the-vulnerability-exploiting-cve-2021-22659">Unveiling the Vulnerability: Exploiting CVE-2021-22659</h1>
<p>As the world becomes increasingly interconnected, the importance of securing industrial control systems has never been more critical. One glaring vulnerability, <strong>CVE-2021-22659</strong>, has put Rockwell Automation’s widely used MicroLogix 1400 PLC under scrutiny. Our analysis at OPSWAT has revealed how a lack of proper security measures can be exploited by attackers, posing serious risks to operational technology (OT) environments.</p>
<h2 id="understanding-the-vulnerability">Understanding the Vulnerability</h2>
<p>Through extensive analysis, my OPSWAT Graduate Fellowship team discovered that during Modbus TCP communication, the protocol does not implement authentication or encryption for the packets being transmitted. This oversight allows a remote attacker, armed with basic knowledge, to sniff network packets and send malicious requests to the PLC without any form of authentication.</p>
<p>The MicroLogix 1400 PLC further compounds this vulnerability with inadequate input validation. A malicious actor can flood the device with random values, overwhelming its capacity and potentially causing a crash. The implications of such an attack can be devastating, leading to unexpected downtime and operational disruptions.</p>
<h2 id="the-process-of-register-overwriting">The Process of Register Overwriting</h2>
<p>To delve deeper into this vulnerability, we initially focused on capturing Modbus TCP packets responsible for reading and writing registers on the PLC. Utilizing an application called <strong>Modbus Poll</strong>, which facilitates interaction with the MicroLogix 1400, we analyzed the packets exchanged during typical operations.</p>
<p><img src="/images/d121024/how-metadefender-ot-security-protects-the-micrologix-from-cve-2021-22659-7.jpg" alt="Line"></p>
<p>By employing <strong>Wireshark</strong>, a powerful packet-sniffing tool, we identified the specific Modbus TCP packet format used for writing a single register.</p>
<p><img src="/images/d121024/how-metadefender-ot-security-protects-the-micrologix-from-cve-2021-22659-8.jpg" alt="Line"></p>
<p><img src="/images/d121024/how-metadefender-ot-security-protects-the-micrologix-from-cve-2021-22659-9.jpg" alt="Line"></p>
<p>With this knowledge, we crafted a simple Python script capable of sending TCP packets to the target PLC at IP address <strong>192.168.93.89</strong>.</p>
<p><img src="/images/d121024/how-metadefender-ot-security-protects-the-micrologix-from-cve-2021-22659-10.jpg" alt="Line"></p>
<p>Upon executing this script, we were able to manipulate the PLC’s registers with malicious, unauthenticated packets, effectively overwriting crucial values.</p>
<p><img src="/images/d121024/how-metadefender-ot-security-protects-the-micrologix-from-cve-2021-22659-11.jpg" alt="Line"></p>
<p>In Micro Logix 1400, most math instructions use three parameters: Source A, Source B and Destination</p>
<p><img src="/images/d121024/how-metadefender-ot-security-protects-the-micrologix-from-cve-2021-22659-12.jpg" alt="Line"></p>
<p>The values for Source A and Source B can come from two 16-bit registers named N13:3 and N13:4. Furthermore, the values in these 16-bit registers, such as N13:3 and N13:4, are constrained within the range of -32,768 to +32,767. If the values of N13:3 and N13:4 are large, the result of the match instruction may exceed the data type&rsquo;s maximum range, potentially causing the PLC to crash. Consequently, to induce a crash in the PLC, it is necessary to write large random values to all registers, including N13:3 and N13:4. To achieve this, we modified our Python script as follows:</p>
<p><img src="/images/d121024/how-metadefender-ot-security-protects-the-micrologix-from-cve-2021-22659-13.jpg" alt="Line"></p>
<h2 id="triggering-a-crash-the-simulation">Triggering a Crash: The Simulation</h2>
<p>To simulate a real-world attack scenario, our team executed the script in the controlled environment of OPSWAT’s CIP Labs. We assumed that both the attacker and the PLC were on the same network, enabling direct communication.</p>
<p>Under normal circumstances, the MicroLogix 1400 PLC operates in <strong>REMOTE RUN mode</strong>, with all register values falling within their designated limits.</p>
<p><img src="/images/d121024/how-metadefender-ot-security-protects-the-micrologix-from-cve-2021-22659-14.jpg" alt="Line"></p>
<p>However, upon running our script, we bombarded the PLC with Modbus TCP packets requesting the writing of large, random values to all registers.</p>
<p><img src="/images/d121024/how-metadefender-ot-security-protects-the-micrologix-from-cve-2021-22659-15.jpg" alt="Line"></p>
<p>As anticipated, the values of the registers, including <strong>N13:3</strong> and <strong>N13:4</strong>, were manipulated to exceed their maximum allowable range. Specifically, these registers were set to <strong>16,990</strong>, leading to an integer overflow during an ADD operation. Since these registers are constrained to a 16-bit signed integer range of <strong>-32,768 to +32,767</strong>, the result exceeded the limit, triggering a fault condition.</p>
<h2 id="the-result-system-crash">The Result: System Crash</h2>
<p>The outcome of our exploitation was successful; the MicroLogix 1400 PLC transitioned to a <strong>FAULTED state</strong>, indicating a complete interruption of its operational capabilities. This demonstration starkly illustrates the risks associated with vulnerabilities like CVE-2021-22659 and the potential for significant disruption in industrial settings.</p>
<p><img src="/images/d121024/how-metadefender-ot-security-protects-the-micrologix-from-cve-2021-22659-16.jpg" alt="Line"></p>
<h1 id="effective-remediation-strategies-for-cve-2021-22659">Effective Remediation Strategies for CVE-2021-22659</h1>
<p><img src="/images/d121024/how-metadefender-ot-security-protects-the-micrologix-from-cve-2021-22659-17.jpg" alt="Line"></p>
<p>In an era where vulnerabilities like CVE-2021-22659 threaten the integrity of operational technology (OT) and cyber-physical systems, implementing a robust remediation strategy is essential. Protecting these critical systems requires a proactive approach to detect, mitigate, and respond to potential attacks. Below are key strategies that organizations can employ to safeguard their MicroLogix 1400 PLCs and similar devices:</p>
<ol>
<li><strong>Regular Vulnerability Scanning.</strong>
The first line of defense against known vulnerabilities is to conduct regular scans of your network. By routinely checking for weaknesses like CVE-2021-22659, organizations can identify and remediate vulnerabilities before they can be exploited by malicious actors. Automated tools can help streamline this process, ensuring that no potential threats go unnoticed.</li>
<li><strong>Anomaly Detection and Behavior Monitoring.</strong>
Monitoring for unusual behaviors within your network is critical. Any significant increase in communication frequency to the MicroLogix 1400 PLC could indicate an ongoing attack or unauthorized data transfer. Implementing systems that flag these anomalies allows organizations to act swiftly, potentially stopping an attack in its tracks before it escalates.</li>
<li><strong>Identifying New Device Connections.</strong>
Keeping track of devices that connect to the PLC is vital for maintaining network integrity. Organizations should have mechanisms in place to detect any new connections, as unauthorized devices can serve as entry points for attackers. This proactive measure can significantly reduce the risk of external breaches.</li>
<li><strong>Network Segmentation.</strong>
One of the most effective strategies for containing potential threats is network segmentation. By isolating affected devices, organizations can limit the lateral spread of attacks, minimizing the overall impact. Segmenting networks not only enhances security but also makes it easier to manage and monitor individual sections of the system.</li>
</ol>
<h2 id="leveraging-metadefender-ot-security">Leveraging MetaDefender OT Security</h2>
<p>To address these critical needs, OPSWAT’s MetaDefender OT Security offers comprehensive solutions tailored for industrial environments. This powerful toolset not only detects known CVEs but also continuously monitors network activity for unusual behaviors. By identifying unauthorized connections, it ensures that your systems remain secure.</p>
<p>Using advanced AI algorithms, MetaDefender learns normal traffic patterns over time, establishing a baseline of expected behavior. This intelligent system can swiftly detect anomalies, allowing for instant and informed responses to potential threats.</p>
<p>In the event of an attack exploiting CVE-2021-22659, MetaDefender OT Security integrates seamlessly with the MetaDefender Industrial Firewall. This partnership allows for the immediate blocking of suspicious communications based on predefined rules. The firewall, equipped with AI capabilities, adapts to regular traffic patterns and enforces policies that prevent unauthorized connections.</p>
<h2 id="the-ideal-defense-mechanism">The Ideal Defense Mechanism</h2>
<p>By combining detection, alerting, and network segmentation, MetaDefender OT Security emerges as the ideal defense mechanism for industrial environments. It significantly reduces the risk and impact of cyber threats, ensuring that organizations can focus on their core operations without the looming fear of vulnerabilities.</p>
<p>In a landscape where the stakes are high, adopting a multi-faceted approach to security is not just advisable—it’s essential. With the right strategies in place, organizations can confidently navigate the complexities of the digital world, protecting their critical systems from potential exploitation.</p>
<h1 id="references">References</h1>
<ol>
<li>OPSWAT. (2024, October 3). <em>Protecting OT Systems from Remote Attacks: How MetaDefender OT Security™ Protects the Micrologix™ 1400 Controller from CVE-2021-22659</em>. Retrieved from <a href="https://www.opswat.com/blog/protecting-ot-systems-from-remote-attacks-how-metadefender-ot-securitytm-protects-the-micrologixtm-1400-controller-from-cve-2021-22659">https://www.opswat.com/blog/protecting-ot-systems-from-remote-attacks-how-metadefender-ot-securitytm-protects-the-micrologixtm-1400-controller-from-cve-2021-22659</a></li>
<li><em>CVE-2021-22659 Detail</em>. National Institute of Standards and Technology. Retrieved from <a href="https://nvd.nist.gov/vuln/detail/CVE-2021-22659">https://nvd.nist.gov/vuln/detail/CVE-2021-22659</a></li>
</ol>
<h1 id="connect-with-me">Connect with Me</h1>
<p>Connect with me on <a href="https://www.facebook.com/dangduongminhnhat/">Facebook</a>, <a href="https://www.linkedin.com/in/nhatdang1901/">LinkedIn</a>, via email at <a href="mailto:dangduongminhnhat2003@gmail.com">dangduongminhnhat2003@gmail.com</a>, <a href="https://github.com/dangduongminhnhat">GitHub</a>, or by phone at +84829258815.</p>


        
          <div class="blog-tags">
            
              
              <a href="https://dangduongminhnhat.github.io/tags/cve-2021-22659/">CVE-2021-22659</a>&nbsp;
            
              
              <a href="https://dangduongminhnhat.github.io/tags/micrologix-1400/">MicroLogix 1400</a>&nbsp;
            
              
              <a href="https://dangduongminhnhat.github.io/tags/industrial-control-systems/">Industrial Control Systems</a>&nbsp;
            
              
              <a href="https://dangduongminhnhat.github.io/tags/cybersecurity/">CyberSecurity</a>&nbsp;
            
              
              <a href="https://dangduongminhnhat.github.io/tags/opswat-fellowship/">OPSWAT Fellowship</a>&nbsp;
            
              
              <a href="https://dangduongminhnhat.github.io/tags/vulnerability-research/">Vulnerability Research</a>&nbsp;
            
              
              <a href="https://dangduongminhnhat.github.io/tags/modbus-protocol/">Modbus Protocol</a>&nbsp;
            
              
              <a href="https://dangduongminhnhat.github.io/tags/remediation-strategies/">Remediation Strategies</a>&nbsp;
            
              
              <a href="https://dangduongminhnhat.github.io/tags/operational-technology/">Operational Technology</a>&nbsp;
            
          </div>
        

        

        
      </article>
      

      
        <ul class="pager blog-pager">
          
            <li class="previous">
              <a href="https://dangduongminhnhat.github.io/posts/d071024/from-merkel-trees-to-ethereum/" data-toggle="tooltip" data-placement="top" title="From Merkle Trees to Ethereum: A Journey Through Blockchain Technology">&larr; Previous Post</a>
            </li>
          
          
            <li class="next">
              <a href="https://dangduongminhnhat.github.io/posts/d231024/unlocking-the-future-of-blockchain/" data-toggle="tooltip" data-placement="top" title="Unlocking the Future of Blockchain: Exploring ZK-Rollups and zkEVM">Next Post &rarr;</a>
            </li>
          
        </ul>
      


      

    </div>
  </div>
</div>

      <footer>
  <div class="container">
    
    <div class="row">
      <div class="col-lg-8 col-lg-offset-2 col-md-10 col-md-offset-1">
        <ul class="list-inline text-center footer-links">
          
          
        </ul>
        <p class="credits copyright text-muted">
          

          &nbsp;&bull;&nbsp;&copy;
          
            2025
          

          
            &nbsp;&bull;&nbsp;
            <a href="https://dangduongminhnhat.github.io/">Daminha Blog</a>
          
        </p>
        
        <p class="credits theme-by text-muted">
          <a href="https://gohugo.io">Hugo v0.129.0</a> powered &nbsp;&bull;&nbsp; Theme <a href="https://github.com/halogenica/beautifulhugo">Beautiful Hugo</a> adapted from <a href="https://deanattali.com/beautiful-jekyll/">Beautiful Jekyll</a>
          
        </p>
      </div>
    </div>
  </div>
</footer><script defer src="https://cdn.jsdelivr.net/npm/katex@0.16.7/dist/katex.min.js" integrity="sha384-G0zcxDFp5LWZtDuRMnBkk3EphCK1lhEf4UEyEM693ka574TZGwo4IWwS6QLzM/2t" crossorigin="anonymous"></script>
<script defer src="https://cdn.jsdelivr.net/npm/katex@0.16.7/dist/contrib/auto-render.min.js" integrity="sha384-+VBxd3r6XgURycqtZ117nYw44OOcIax56Z4dCRWbxyPt0Koah1uHoK0o4+/RRE05" crossorigin="anonymous" onload="renderMathInElement(document.body);"></script>
<script src="https://code.jquery.com/jquery-3.7.0.slim.min.js" integrity="sha384-w5y/xIeYixWvfM+A1cEbmHPURnvyqmVg5eVENruEdDjcyRLUSNej7512JQGspFUr" crossorigin="anonymous"></script>
<script src="https://cdn.jsdelivr.net/npm/bootstrap@3.4.1/dist/js/bootstrap.min.js" integrity="sha384-aJ21OjlMXNL5UyIl/XNwTMqvzeRMZH2w8c5cRVpzpU8Y5bApTppSuUkhZXN0VxHd" crossorigin="anonymous"></script>

<script src="https://dangduongminhnhat.github.io/js/main.js"></script><script src="https://cdnjs.cloudflare.com/ajax/libs/photoswipe/4.1.2/photoswipe.min.js" integrity="sha384-QELNnmcmU8IR9ZAykt67vGr9/rZJdHbiWi64V88fCPaOohUlHCqUD/unNN0BXSqy" crossorigin="anonymous"></script>
<script src="https://cdnjs.cloudflare.com/ajax/libs/photoswipe/4.1.2/photoswipe-ui-default.min.js" integrity="sha384-m67o7SkQ1ALzKZIFh4CiTA8tmadaujiTa9Vu+nqPSwDOqHrDmxLezTdFln8077+q" crossorigin="anonymous"></script><script src="https://dangduongminhnhat.github.io/js/load-photoswipe.js"></script>










    
  </body>
</html>

